version: "3.8"

services:
  global_planning:
    build:
      context: ..
      dockerfile: docker/action/global_planning/global_planning.Dockerfile
      cache_from:
        - "${ACTION_GLOBAL_PLANNING_IMAGE}:build_${TAG}"
        - "${ACTION_GLOBAL_PLANNING_IMAGE}:build_main"
      target: deploy
    image: "${ACTION_GLOBAL_PLANNING_IMAGE}:${TAG}"
    command: echo 'use this command when files are ready   /bin/bash -c "ros2 launch global_planning global_planning.launch.py"'

  behaviour_planning:
    build:
      context: ..
      dockerfile: docker/action/behaviour_planning/behaviour_planning.Dockerfile
      cache_from:
        - "${ACTION_BEHAVIOUR_PLANNING_IMAGE}:build_${TAG}"
        - "${ACTION_BEHAVIOUR_PLANNING_IMAGE}:build_main"
      target: deploy
    image: "${ACTION_BEHAVIOUR_PLANNING_IMAGE}:${TAG}"
    command: echo 'use this command when files are ready   /bin/bash -c "ros2 launch behaviour_planning behaviour_planning.launch.py"'

  local_planning:
    build:
      context: ..
      dockerfile: docker/action/local_planning/local_planning.Dockerfile
      cache_from:
        - "${ACTION_LOCAL_PLANNING_IMAGE}:build_${TAG}"
        - "${ACTION_LOCAL_PLANNING_IMAGE}:build_main"
      target: deploy
    image: "${ACTION_LOCAL_PLANNING_IMAGE}:${TAG}"
    command: ros2 launch local_planning local_planning.launch.py

  model_predictive_control:
    build:
      context: ..
      dockerfile: docker/action/model_predictive_control/model_predictive_control.Dockerfile
      cache_from:
        - "${ACTION_MPC_IMAGE}:build_${TAG}"
        - "${ACTION_MPC_IMAGE}:build_main"
      target: deploy
    image: "${ACTION_MPC_IMAGE}:${TAG}"
    command: /bin/bash -c "ros2 launch model_predictive_control model_predictive_control.launch.py"

  pure_pursuit_control:
    build:
      context: ..
      dockerfile: docker/action/pure_pursuit_control/pure_pursuit_control.Dockerfile
      cache_from:
        - "${ACTION_PURE_PURSUIT_IMAGE}:build_${TAG}"
        - "${ACTION_PURE_PURSUIT_IMAGE}:build_main"
      target: deploy
    image: "${ACTION_PURE_PURSUIT_IMAGE}:${TAG}"
    command: /bin/bash -c "ros2 launch pure_pursuit_control pure_pursuit_control.launch.py"

  behaviour_tree:
    build:
      context: ..
      dockerfile: docker/action/behaviour_tree/behaviour_tree.Dockerfile
      cache_from:
        - "${ACTION_BEHAVIOUR_TREE_IMAGE}:build_${TAG}"
        - "${ACTION_BEHAVIOUR_TREE_IMAGE}:build_main"
        - "${ACTION_PURE_PURSUIT_IMAGE}:build_main"
      target: deploy
    image: "${ACTION_BEHAVIOUR_TREE_IMAGE}:${TAG}"
    command: /bin/bash -c "ros2 launch behaviour_tree behaviour_tree.launch.py"

  controller_pkg:
      build:
        context: ..
        dockerfile: docker/action/controller_pkg/controller_pkg.Dockerfile
        cache_from:
          - "${ACTION_CONTROLLER_PKG_IMAGE}:build_${TAG}"
          - "${ACTION_CONTROLLER_PKG_IMAGE}:build_main"
        target: deploy
      image: "${ACTION_CONTROLLER_PKG_IMAGE}:${TAG}"
      command: /bin/bash -c "ros2 launch controller_pkg controller.launch.py"