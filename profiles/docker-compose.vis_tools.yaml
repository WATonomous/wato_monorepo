version: "3.8"
services:
  foxglove:
    build:
      context: ..
      dockerfile: docker/infrastructure/data_stream/foxglove.Dockerfile
      cache_from:
        - "${INFRASTRUCTURE_FOXGLOVE_IMAGE:?}:${TAG}"
        - "${INFRASTRUCTURE_FOXGLOVE_IMAGE:?}:main"
    image: "${INFRASTRUCTURE_FOXGLOVE_IMAGE:?}:${TAG}"
    user: ${FIXUID:?}:${FIXGID:?}
    command: ["ros2", "launch", "foxglove_bridge", "foxglove_bridge_launch.xml", "port:=${FOXGLOVE_BRIDGE_PORT:?}"]
    ports:
      - "${FOXGLOVE_BRIDGE_PORT:?}:${FOXGLOVE_BRIDGE_PORT:?}"

#   vnc:
#     build:
#       context: ..
#       dockerfile: docker/infrastructure/vis_tools/vnc.Dockerfile
#       cache_from:
#         # - "${INFRASTRUCTURE_VIS_TOOLS_VNC_IMAGE:?}-${CACHE_FROM_TAG}"
#         - "${INFRASTRUCTURE_VIS_TOOLS_VNC_IMAGE:?}-simulation"
#         - "${INFRASTRUCTURE_VIS_TOOLS_VNC_IMAGE:?}-develop"
#       args:
#         - CARLA_VERSION=0.9.13
#         - COMPOSE_PROJECT_NAME=${COMPOSE_PROJECT_NAME}
#     image: "${INFRASTRUCTURE_VIS_TOOLS_VNC_IMAGE:?}-${TAG}"
#     user: ${FIXUID:?}:${FIXGID:?}
#     ports:
#       - "${GUI_TOOLS_VNC_PORT:?}:5900"
#     environment:
#       - VNC_PORT=${GUI_TOOLS_VNC_PORT:?}
#     volumes:
#       - rviz_configs:/home/docker/ament_ws/src/simulation_rviz_configs
#     runtime: nvidia

# volumes:
#   rviz_configs:
#     driver: local
#     driver_opts:
#       type: none
#       o: bind
#       device: ./src/simulation/rviz_configs