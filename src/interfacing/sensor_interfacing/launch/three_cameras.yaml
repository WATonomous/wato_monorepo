# Copyright (c) 2025-present WATonomous. All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
launch:
  - arg:
      name: "camera_config_file"
      default: "$(find-pkg-share sensor_interfacing)/config/three_cameras_config.yaml"
      description: "Path to camera configuration file"

  - node_container:
      pkg: rclcpp_components
      exec: component_container
      name: spinnaker_camera_container
      namespace: ""

  - load_composable_node:
      target: spinnaker_camera_container
      composable_node:
        # Camera 0
        - pkg: spinnaker_camera_driver
          plugin: spinnaker_camera_driver::CameraDriver
          name: camera
          namespace: flir_camera_0
          remap:
            - from: '~/control'
              to: '/exposure_control/control'
          param:
            - from: $(var camera_config_file)
            - name: parameter_file
              value: $(find-pkg-share spinnaker_camera_driver)/config/blackfly.yaml
          extra_arg:
            - name: use_intra_process_comms
              value: 'true'

        # Camera 1
        - pkg: spinnaker_camera_driver
          plugin: spinnaker_camera_driver::CameraDriver
          name: camera
          namespace: flir_camera_1
          remap:
            - from: '~/control'
              to: '/exposure_control/control'
          param:
            - from: $(var camera_config_file)
            - name: parameter_file
              value: $(find-pkg-share spinnaker_camera_driver)/config/blackfly.yaml
          extra_arg:
            - name: use_intra_process_comms
              value: 'true'

        # Camera 2
        - pkg: spinnaker_camera_driver
          plugin: spinnaker_camera_driver::CameraDriver
          name: camera
          namespace: flir_camera_2
          remap:
            - from: '~/control'
              to: '/exposure_control/control'
          param:
            - from: $(var camera_config_file)
            - name: parameter_file
              value: $(find-pkg-share spinnaker_camera_driver)/config/blackfly.yaml
          extra_arg:
            - name: use_intra_process_comms
              value: 'true'
