# CARLA ROS2 Bridge Configuration

# Scenario Server Configuration
# See https://carla.readthedocs.io/en/latest/adv_synchrony_timestep/ for timing settings
/**/scenario_server:
  ros__parameters:
    carla_host: "localhost"
    carla_timeout: 10.0
    initial_scenario: "carla_scenarios.scenarios.light_traffic_scenario"
    # Simulation timing (see https://carla.readthedocs.io/en/latest/adv_synchrony_timestep/)
    carla_fps: 60.0                  # Sets fixed_delta_seconds = 1/fps
    synchronous_mode: true           # Server waits for client tick
    no_rendering_mode: false         # Disable rendering for faster simulation
    substepping: true                # Enable physics substepping
    max_substep_delta_time: 0.001     # Max physics substep time (seconds)
    max_substeps: 10                  # Max physics substeps per frame

# Ackermann Control Configuration
/**/ackermann_control:
  ros__parameters:
    carla_host: "localhost"
    carla_timeout: 10.0
    role_name: "ego_vehicle"
    command_timeout: 0.5
    control_rate: 50.0

# Camera Publisher Configuration
# Supports multiple cameras - each camera publishes to ~/{name}/image_raw and ~/{name}/camera_info
/**/camera_publisher:
  ros__parameters:
    carla_host: "localhost"
    carla_timeout: 10.0
    role_name: "ego_vehicle"
    # List of camera names to spawn
    camera_names:
      - front_camera
    # Per-camera settings (prefix with camera name)
    front_camera.frame_id: "front_camera_optical"
    front_camera.image_width: 800
    front_camera.image_height: 600
    front_camera.fov: 90.0
    front_camera.optical_frame: true
    front_camera.distortion_model: "plumb_bob"
    # Camera matrix K (3x3, row-major): [fx, 0, cx, 0, fy, cy, 0, 0, 1]
    front_camera.camera_matrix.data: [400.0, 0.0, 400.0,
                                      0.0, 400.0, 300.0,
                                      0.0, 0.0, 1.0]
    # Distortion coefficients (plumb_bob): [k1, k2, p1, p2, k3]
    front_camera.distortion_coefficients.data: [0.0, 0.0, 0.0, 0.0, 0.0]
    # Rectification matrix R (3x3, row-major)
    front_camera.rectification_matrix.data: [1.0, 0.0, 0.0,
                                             0.0, 1.0, 0.0,
                                             0.0, 0.0, 1.0]
    # Projection matrix P (3x4, row-major): [fx', 0, cx', Tx, 0, fy', cy', Ty, 0, 0, 1, 0]
    front_camera.projection_matrix.data: [400.0, 0.0, 400.0, 0.0,
                                          0.0, 400.0, 300.0, 0.0,
                                          0.0, 0.0, 1.0, 0.0]

# LiDAR Publisher Configuration
# Supports multiple LiDARs - each LiDAR publishes to ~/{name}/points
# All per-LiDAR fields are required
/**/lidar_publisher:
  ros__parameters:
    carla_host: "localhost"
    carla_timeout: 10.0
    role_name: "ego_vehicle"
    # List of LiDAR names to spawn
    lidar_names:
      - top_lidar
    # Per-LiDAR settings (prefix with lidar name)
    top_lidar.frame_id: "lidar_cc"               # TF frame for this LiDAR
    top_lidar.range: 100.0                    # Maximum detection range (meters)
    top_lidar.rotation_frequency: 15.0        # Scan rate (Hz)
    top_lidar.horizontal_fov: 360.0           # Horizontal FOV (degrees)
    top_lidar.points_per_channel: 1800        # Points per channel per rotation
    # Vertical FOV configuration (CARLA distributes channels uniformly)
    top_lidar.channels: 32                    # Number of laser channels
    top_lidar.upper_fov: 15.0                 # Highest laser angle (degrees)
    top_lidar.lower_fov: -25.0                # Lowest laser angle (degrees)
    # Dropout configuration (tuned for minimal loss like real Velodyne)
    top_lidar.dropoff_general_rate: 0.0       # Random dropout rate (0.0 = no dropout)
    top_lidar.dropoff_intensity_limit: 0.8    # Intensity above which no dropout occurs
    top_lidar.dropoff_zero_intensity: 0.1     # Dropout probability for zero-intensity points
    # Atmosphere and noise
    top_lidar.atmosphere_attenuation_rate: 0.004  # Intensity loss per meter
    top_lidar.noise_stddev: 0.0               # Distance noise std dev (0.0 = no noise)

# BBox Publisher Configuration
/**/bbox_publisher:
  ros__parameters:
    carla_host: "localhost"
    carla_timeout: 10.0
    # Publishing settings
    publish_rate: 10.0
    frame_id: "base_link"
    include_vehicles: true
    include_pedestrians: true
    max_distance: -1.0  # Max distance from ego vehicle in meters (-1 = no limit)

# Localization Configuration (TF publisher)
/**/carla_localization:
  ros__parameters:
    carla_host: "localhost"
    carla_timeout: 10.0
    role_name: "ego_vehicle"
    # TF frame names
    map_frame: "map"
    odom_frame: "odom"
    base_link_frame: "base_link"
    publish_rate: 50.0  # Hz

# Teleop Configuration (Foxglove compatible)
/**/carla_teleop:
  ros__parameters:
    carla_host: "localhost"
    carla_timeout: 10.0
    role_name: "ego_vehicle"
    max_speed: 10.0
    max_steering: 1.0
    throttle_scale: 1.0
    steering_scale: 1.0
    command_timeout: 0.5
    control_rate: 50.0

# Pygame HUD Configuration (web-based map visualizer)
/**/pygame_hud:
  ros__parameters:
    carla_host: "localhost"
    carla_timeout: 10.0
    role_name: "ego_vehicle"
    width: 1280
    height: 720
    show_triggers: false
    show_connections: false
    show_spawn_points: false
    frame_rate: 30.0
