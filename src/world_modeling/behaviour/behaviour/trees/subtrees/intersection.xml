<root BTCPP_format="4" main_tree_to_execute="IntersectionTree">
  <include path="subtrees/yield.xml" />
  <include path="subtrees/stop_sign.xml" />
  <include path="subtrees/traffic_light.xml" />
  <BehaviorTree ID="IntersectionTree">
    <Sequence>
      <GetIntersectionContext
        lane_ctx="{current_lane_ctx}"
        route="{global_route}"
        route_index_map="{global_route_index_map}"
        lookahead_threshold_m="40.0"
        in_active_traffic_control_element="{active_traffic_control_element}"
        out_active_traffic_control_lanelet_id="{active_traffic_control_lanelet_id}"
        out_active_traffic_control_element="{active_traffic_control_element}"
      />

      <ActiveTrafficControlElementExist
        active_traffic_control_element="{active_traffic_control_element}" />

      <Fallback name="Handle Traffic Control Element">
        <Sequence name="Handle STOP_SIGN Element">
          <IsRegulatoryElementType reg_elem="{active_traffic_control_element}" expected="STOP_SIGN" />

          <!-- subtree to handle stop sign -->

        </Sequence>
        <Sequence name="Handle TRAFFIC_LIGHT Element">
          <IsRegulatoryElementType reg_elem="{active_traffic_control_element}"
            expected="TRAFFIC_LIGHT" />

          <!-- subtree to handle traffic light -->

        </Sequence>
        <Sequence name="Handle YIELD Element">
          <IsRegulatoryElementType reg_elem="{active_traffic_control_element}" expected="YIELD" />

          <!-- subtree to handle yield -->

        </Sequence>
      </Fallback>
    </Sequence>
  </BehaviorTree>
</root>