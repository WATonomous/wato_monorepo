<BehaviorTree ID="YieldSubTree">
    <Sequence name="Handle Stop Sign">
        <IsRegulatoryElementType reg_elem="{active_traffic_control_element}" expected="STOP_SIGN" />

        <SetWallService stop_line_id="{active_traffic_control_lanelet_id}" command="1"
            service_name="/world_modeling/spawn_wall" />

        <EgoStopped ego_velocity="{ego_state.velocity_mps}" threshold_velocity="0.10" />

        <GetStopSignCars
            active_traffic_control_element="{active_traffic_control_element}"
            dynamic_objects_snapshot="{dynamic_objects.snapshot}"
            include_right_of_way="true"
            out_car_ids="{stop_sign.car_ids}" />

        <SetStopSignLatchedCars
            active_traffic_control_element="{active_traffic_control_element}"
            in_current_ids="{stop_sign.car_ids}"
            out_baseline_ids="{stop_sign.latched_ids}" />

        <!-- gap timer lives here -->
        <StopSignCanProceed
            active_traffic_control_element="{active_traffic_control_element}"
            in_current_ids="{stop_sign.car_ids}"
            in_baseline_ids="{stop_sign.latched_ids}"
            gap_time_s="1.5" />

        <SetWallService stop_line_id="{active_traffic_control_lanelet_id}" command="0"
            service_name="/world_modeling/despawn_wall" />

        <!-- TODO: Add condition to see if passed intersection -->

        <ClearActiveTrafficControlElement
            active_traffic_control_element="{active_traffic_control_element}" />

        <ClearStopSignLatchedCars out_baseline_ids="{stop_sign.latched_ids}" />
    </Sequence>
</BehaviorTree>