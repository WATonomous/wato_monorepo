<?xml version="1.0"?>
<!--
  Copyright (c) 2025-present WATonomous. All rights reserved.
-->
<root BTCPP_format="4">

  <BehaviorTree ID="Navigation">
    <Sequence name="navigation_logic">

      <!-- 1. Determine what to do based on path and current context -->
      <DetermineLaneBehaviour
          lanelet_context="{current_lane_context}"
          path="{global_path}"
          behaviour="{next_behaviour}"
          target_lanelet="{target_lanelet}" />

      <!-- 2. Safety Checks for the target lanelet -->
      <Sequence name="safety_checks">
        <GetObjectsByLanelet
            lanelet_id="{target_lanelet.id}"
            objects="{nearby_objects}" />

        <SafeProximity
            objects="{nearby_objects}"
            current_point="{current_point}"
            radius="15.0" />

        <SafePrediction
            objects="{nearby_objects}"
            current_point="{current_point}"
            radius="20.0" />
      </Sequence>

      <!-- 3. Execute the determined behaviour -->
      <ExecuteBehaviour
          action_name="execute_behaviour"
          behaviour="{next_behaviour}" />

    </Sequence>
  </BehaviorTree>

</root>
